# Comment lines with a "#" may mean package(s) are not in use.
# You are free to uncomment some of them.
# They are provided as a suggestion of possible optimization settings.

# Any changes mentioned may require a rebuild.  Typically
# sections with fixes require rebuilds.

# Assembly-like code, parsers
#app-emulation/* O2.conf
app-shells/* O2.conf
dev-*/* O2.conf
#games-emulation/* O2.conf
net-libs/* O2.conf
net-wireless/* O2.conf
sys-devel/* O2.conf
sys-fs/* O2.conf
x11-base/* O2.conf
x11-drivers/* O2.conf
x11-libs/* O2.conf

# Compression algs and libs
app-arch/* O2.conf
dev-libs/c-blosc O2.conf
dev-libs/lzo O2.conf
sys-libs/zlib O2.conf

# Fixes
app-editors/emacs remove-lto.conf # 27.2 supports lto but experimental but not added to ebuild yet.  Wait for ebuild fork.
app-emulation/docker use-gcc.conf # Build failure
app-emulation/runc use-gcc.conf # Build time failure
dev-lang/mono remove-lto.conf # Breaks with clang lto
dev-lang/rust rust.conf
dev-libs/dotconf use-gcc.conf # Breaks on clang lto
dev-libs/elfutils use-gcc.conf remove-lto.conf # ebuild strips -flto
dev-libs/libffi use-gcc.conf # Clang LTO breaks build
dev-qt/qtcore use-gcc.conf remove-lto.conf  # _mm_crc32_* broken on clang on older machines \
# error: always_inline function '_mm_crc32_u64' requires target feature 'crc32', but would be inlined into function 'crc32' that is compiled without support for 'crc32'
dev-util/shellcheck use-gcc.conf remove-lto.conf # Build time breakage with clang
gnome-base/librsvg remove-lto.conf link-ubsan.conf # TODO: Apply lto to both rust and c.  error: LLVM gold plugin: inconsistent LTO Unit splitting (recompile with -fsplit-lto-unit)
media-libs/alsa-lib use-gcc.conf # Errors: \
# Build time failure (with ldd thinlto): ld.lld: error: <inline asm>:1:1: default version symbol snd_dlopen@@ALSA_1.1.6 must be defined; \
# Build time failure (with goldlto): function __cfi_check_fail: error: undefined reference to '__ubsan_handle_cfi_check_fail_abort'
media-libs/x264 use-gcc.conf # clang lto breaks in configure endian test.
net-libs/nodejs use-gcc.conf use-gcc-10.conf
sys-boot/grub use-gcc.conf grub.conf # Configure time problems
sys-devel/clang use-gcc.conf # Build time breakage. FAILED: lib/Tooling/ASTNodeAPI.json ; segfaults with clang-ast-dump reported from dmesg
sys-devel/gdb use-gcc.conf # Build time failure
sys-devel/llvm split-lto-unit.conf # Build time failure in clang package
sys-devel/llvm remove-lto.conf remove-split-lto-unit.conf # \
# Build time failure using llvm:13 static-libs that have been Clang LTOed, and \
# static-libs linked with a clang built with the gcc compiler: \
# /usr/lib/llvm/13/lib/libLLVMSupport.a: error adding symbols: file format not recognized
sys-fs/extundelete extundelete.conf
sys-libs/binutils-libs use-gcc.conf remove-lto.conf
sys-process/numactl use-gcc.conf remove-lto.conf # ebuild strips -flto
x11-misc/wmname wmname.conf disable-thinlto.conf use-gold.conf

# media-libs/libglvnd # Build time failure: ld.lld: error: undefined symbol: entrypointFunctions
# See oiledmachine-overlay for LTO patch which is necessary for CFIed package.

# Fixes for packages that use both gcc and clang but cannot happen with -flto=thin
# It may be acceptable to use both if the build parts are independent and with gold or bfd only.
dev-libs/libtomcrypt use-gcc.conf # Uses gcc and clang which gcc doesn't understand -flto=thin
sys-libs/libapparmor use-gcc.conf # Errors: \
# Uses gcc and clang \
# ld.lld: warning: attempt to reassign symbol 'parse_record' of version 'APPARMOR_1.0' to version 'APPARMOR_1.1'

#dev-libs/openssl use-bfd.conf # not necessary if curl is built with curl_ssl_gnutls
net-misc/curl use-bfd.conf

# Bug:  internal compiler error: maximum number of LRA assignment passes is achieved (30)
# -O2 broken with both gcc 10.3.0, 11.2.0 when building clang
# Using -fno-schedule-insns will not help
# -O1 or -Os works
sys-devel/clang Os.conf # Build time breakage.

# Containing crypto ciphers and hash algorithms
# Unrollable means that you need a per-package patch to unroll the specific functions.
# See unroll-loops.conf for code generation time tradeoff details.
# -O2 because data is not independent.
app-arch/arj # unrollable
# app-arch/cabextract # md5 unrolled already
app-arch/lrzip # unrollable
app-arch/p7zip # unrollable
app-arch/unace # unrollable
app-arch/unrar # unrollable
app-arch/unzip
app-arch/zip # unrollable
app-crypt/* O2.conf
app-crypt/rhash # unrollable
#app-emulation/wine-staging
#app-emulation/wine-vanilla
dev-cpp/abseil-cpp
dev-lang/perl
dev-lang/php
dev-lang/python
dev-lang/ruby
dev-lang/rust
dev-libs/apr-util
dev-libs/glib
dev-libs/libgcrypt # unrollable
#dev-libs/libgit2 # sha1 already unrolled
dev-libs/libsodium # unrollable
#dev-libs/libtomcrypt
dev-libs/nettle # unrollable
dev-libs/nss # unrollable
dev-libs/openssl # unrollable
dev-libs/xxhash # unrollable
dev-vcs/git O2.conf # unrollable
media-libs/libdvdread # unrollable
#net-libs/libtorrent # unrolled already.
net-libs/nodejs
net-libs/mbedtls # unrollable
net-misc/curl O2.conf # unrollable
#net-misc/cgminer O2.conf
#net-misc/bfgminer O2.conf
net-misc/wget O2.conf # already unrolled
#net-p2p/* O2.conf
sci-misc/boinc O2.conf
#sys-fs/loop-aes
sys-libs/glibc O2.conf # unrollable
x11-wm/xpra O2.conf # unrollable

# 3D, computational geometry algorithms, graphics / drawing algorithms
app-text/ghostscript-gpl O3.conf
dev-games/* O3.conf fast-math.conf
dev-libs/boost O3.conf
dev-libs/isl O3.conf
dev-python/numpy O3.conf
games-engines/* O3.conf fast-math.conf
games-fps/* O3.conf fast-math.conf
media-libs/freeglut prefetch-loop-arrays.conf
media-libs/glu prefetch-loop-arrays.conf
media-tv/v4l-utils O3.conf
sci-physics/bullet O3.conf fast-math.conf
x11-misc/xscreensaver O3.conf fast-math.conf

# Mass data processing
sci-libs/* O3.conf

# Media or graphics libs
media-gfx/* O3.conf
media-gfx/blender fast-math.conf
media-libs/* O3.conf
media-libs/libvisual fast-math.conf
media-plugins/libvisual-plugins fast-math.conf
media-plugins/libvisual-projectm fast-math.conf
media-sound/* O3.conf
media-video/* O3.conf
x11-libs/cairo O3.conf
x11-libs/gdk-pixbuf O3.conf
x11-libs/pango O3.conf
x11-libs/pixman O3.conf #multicoreloops.conf

# Sound processing
# Disable section if lossless preferred
media-libs/libsamplerate fast-math.conf prefetch-loop-arrays.conf
media-sound/libsndfile fast-math.conf prefetch-loop-arrays.conf

# DAW (digital audio workstations)
# Disable section if lossless preferred
media-sound/ardour fast-math.conf
media-sound/audacity fast-math.conf
media-sound/lmms fast-math.conf

# non-turn based games
games-action/* O2.conf
games-arcade/* O2.conf
games-simulation/* O2.conf
games-strategy/* O2.conf
games-sports/* O2.conf

# Contains codecs
www-client/firefox O3.conf prefetch-loop-arrays.conf skipless.conf

# Contains codecs.  The two lines are mutually exclusive.  Choose only one
#www-client/chromium O3.conf prefetch-loop-arrays.conf skipless.conf # Remove # if using GCC
www-client/chromium O3.conf # Remove # if using Clang CFI

# Sequential processing (matrices)
# Eigen, a header only matrix lib, may benefit?  See also
# `grep --exclude-dir=distfiles --exclude=*Manifest --exclude-dir=metadata --exclude-dir=.git -l -i -r -e "eigen" /usr/portage`
# We don't unroll these below but prefer autopar instead through O3.
# dev-cpp/eigen # is header only
# dev-libs/boost # ublas is header only
dev-libs/isl prefetch-loop-arrays.conf
dev-python/numpy prefetch-loop-arrays.conf
media-libs/ilmbase prefetch-loop-arrays.conf
#media-libs/graphene # just elementary operations, already unrolled
media-libs/lcms prefetch-loop-arrays.conf
media-libs/libmypaint prefetch-loop-arrays.conf
media-libs/zimg prefetch-loop-arrays.conf
sci-libs/gsl prefetch-loop-arrays.conf
x11-libs/cairo prefetch-loop-arrays.conf
x11-libs/pango prefetch-loop-arrays.conf
x11-libs/pixman prefetch-loop-arrays.conf

# Sequential processing (media containers)
media-libs/libmatroska prefetch-loop-arrays.conf skipless.conf
media-libs/libmp4v2 prefetch-loop-arrays.conf skipless.conf
media-libs/libogg prefetch-loop-arrays.conf skipless.conf

# Sequential processing (video, image)
gnome-base/librsvg prefetch-loop-arrays.conf
media-libs/dav1d prefetch-loop-arrays.conf skipless.conf
media-libs/freetype prefetch-loop-arrays.conf
media-libs/giflib prefetch-loop-arrays.conf
media-libs/imlib2 prefetch-loop-arrays.conf
media-libs/jbig2dec prefetch-loop-arrays.conf
media-libs/kvazaar prefetch-loop-arrays.conf
media-libs/libaom prefetch-loop-arrays.conf skipless.conf
media-libs/libbluray prefetch-loop-arrays.conf
media-libs/libde265 prefetch-loop-arrays.conf skipless.conf
media-libs/libheif prefetch-loop-arrays.conf
media-libs/libjpeg-turbo prefetch-loop-arrays.conf
media-libs/libmng prefetch-loop-arrays.conf
media-libs/libmpeg2 prefetch-loop-arrays.conf skipless.conf
media-libs/libpng prefetch-loop-arrays.conf
media-libs/libpng-compat prefetch-loop-arrays.conf
media-libs/libspng prefetch-loop-arrays.conf
media-libs/libtheora prefetch-loop-arrays.conf skipless.conf
media-libs/libvpx prefetch-loop-arrays.conf skipless.conf
media-libs/libwebp prefetch-loop-arrays.conf
media-libs/libwmf prefetch-loop-arrays.conf
media-libs/mozjpeg prefetch-loop-arrays.conf
media-libs/opencv prefetch-loop-arrays.conf
media-libs/openexr prefetch-loop-arrays.conf
#media-libs/openh264 prefetch-loop-arrays.conf skipless.conf
media-libs/openjpeg prefetch-loop-arrays.conf
media-libs/tiff prefetch-loop-arrays.conf
media-libs/x264 prefetch-loop-arrays.conf
media-libs/x265 prefetch-loop-arrays.conf
media-libs/xvid prefetch-loop-arrays.conf skipless.conf
media-gfx/alembic prefetch-loop-arrays.conf
media-gfx/graphicsmagick prefetch-loop-arrays.conf
media-gfx/imagemagick prefetch-loop-arrays.conf
media-gfx/optipng prefetch-loop-arrays.conf
media-gfx/pngquant prefetch-loop-arrays.conf
media-video/dirac prefetch-loop-arrays.conf skipless.conf
media-video/ffmpeg prefetch-loop-arrays.conf skipless.conf
media-video/handbrake prefetch-loop-arrays.conf
media-video/mjpegtools prefetch-loop-arrays.conf
media-video/mplayer prefetch-loop-arrays.conf
media-video/vlc prefetch-loop-arrays.conf
x11-libs/gdk-pixbuf prefetch-loop-arrays.conf

# Sequential processing (sound)
media-libs/chromaprint prefetch-loop-arrays.conf
media-libs/faac prefetch-loop-arrays.conf
media-libs/faad2 prefetch-loop-arrays.conf skipless.conf
media-libs/flac prefetch-loop-arrays.conf skipless.conf
media-libs/fdk-aac prefetch-loop-arrays.conf skipless.conf
media-libs/libmad prefetch-loop-arrays.conf skipless.conf
media-libs/libmodplug prefetch-loop-arrays.conf skipless.conf
media-libs/libofa prefetch-loop-arrays.conf
media-libs/libsamplerate prefetch-loop-arrays.conf
media-libs/libsndfile prefetch-loop-arrays.conf skipless.conf
media-libs/libsoundtouch prefetch-loop-arrays.conf
media-libs/libvorbis prefetch-loop-arrays.conf skipless.conf
media-libs/opus prefetch-loop-arrays.conf skipless.conf
media-libs/soxr prefetch-loop-arrays.conf
media-libs/speex prefetch-loop-arrays.conf skipless.conf
media-libs/speexdsp prefetch-loop-arrays.conf
media-libs/vo-aacenc prefetch-loop-arrays.conf
media-libs/vo-amrwbenc prefetch-loop-arrays.conf
media-sound/lame prefetch-loop-arrays.conf
media-sound/mpg123 prefetch-loop-arrays.conf skipless.conf
media-sound/toolame prefetch-loop-arrays.conf
media-sound/twolame prefetch-loop-arrays.conf
media-sound/wavpack prefetch-loop-arrays.conf skipless.conf
sci-libs/fftw prefetch-loop-arrays.conf

# Sequential processing (strings)
sys-apps/grep prefetch-loop-arrays.conf

# Sequential processing (compression)
dev-libs/c-blosc prefetch-loop-arrays.conf
dev-libs/lzo prefetch-loop-arrays.conf
app-arch/arj prefetch-loop-arrays.conf
app-arch/brotli prefetch-loop-arrays.conf
app-arch/bzip2 prefetch-loop-arrays.conf
app-arch/cabextract prefetch-loop-arrays.conf
app-arch/cpio prefetch-loop-arrays.conf
app-arch/gzip prefetch-loop-arrays.conf
app-arch/lcab prefetch-loop-arrays.conf
app-arch/lha prefetch-loop-arrays.conf
app-arch/lrzip prefetch-loop-arrays.conf
app-arch/lz4 prefetch-loop-arrays.conf
app-arch/lz5 prefetch-loop-arrays.conf
app-arch/lzip prefetch-loop-arrays.conf
app-arch/lzma prefetch-loop-arrays.conf
app-arch/lzop prefetch-loop-arrays.conf
app-arch/ncompress prefetch-loop-arrays.conf
app-arch/p7zip prefetch-loop-arrays.conf
app-arch/pbzip2 prefetch-loop-arrays.conf
app-arch/pigz prefetch-loop-arrays.conf
#app-arch/rar # binary only ; rar format contains encryption support
app-arch/snappy prefetch-loop-arrays.conf
# app-arch/stormlib prefetch-loop-arrays.conf # not in use
app-arch/tar prefetch-loop-arrays.conf
app-arch/unace prefetch-loop-arrays.conf
app-arch/unrar prefetch-loop-arrays.conf
app-arch/unzip prefetch-loop-arrays.conf
app-arch/xz-utils prefetch-loop-arrays.conf
app-arch/zip prefetch-loop-arrays.conf
app-arch/zopfli prefetch-loop-arrays.conf
app-arch/zstd prefetch-loop-arrays.conf
app-crypt/libb2 prefetch-loop-arrays.conf
sys-libs/zlib prefetch-loop-arrays.conf

# Optimize branching
# This section is for monotaskers, requiring all CPU and IO resources and
# no multitasking.
media-libs/libaom stc.conf
media-libs/libvpx stc.conf
media-libs/x264 stc.conf
media-video/ffmpeg stc.conf

# Clang built
dev-lang/spidermonkey clang-retpoline.conf remove-gcc-flags.conf
dev-libs/icu clang-retpoline.conf remove-gcc-flags.conf
sys-libs/zlib clang-retpoline.conf remove-gcc-flags.conf
media-libs/libaom clang-retpoline.conf remove-gcc-flags.conf
media-libs/libjpeg-turbo clang-retpoline.conf remove-gcc-flags.conf
media-libs/libvpx clang-retpoline.conf remove-gcc-flags.conf
media-libs/flac clang-retpoline.conf remove-gcc-flags.conf
media-libs/mesa clang-retpoline.conf remove-gcc-flags.conf
media-video/ffmpeg clang-retpoline.conf remove-gcc-flags.conf
sys-libs/compiler-rt clang-retpoline.conf remove-gcc-flags.conf
sys-libs/compiler-rt-sanitizers clang-retpoline.conf remove-gcc-flags.conf
sys-libs/libcxx clang-retpoline.conf remove-gcc-flags.conf
sys-libs/libcxxabi clang-retpoline.conf remove-gcc-flags.conf

# -fno-plt is unsupported with lazy binding, so add -Wl,-z,retpolineplt to linker
x11-base/xorg-server use-clang.conf use-lld.conf remove-fno-plt.conf z-retpolineplt.conf
x11-drivers/* use-clang.conf use-wc-lld.conf use-lld.conf remove-fno-plt.conf z-retpolineplt.conf

# If using gcc, you may add # in front of the line below.
# If using clang, you must remove the # in from of the line below.
#sys-devel/llvm use-clang.conf use-lld.conf remove-fno-plt.conf z-retpolineplt.conf

sys-kernel/*-sources disable-gcf-lto.conf
sys-kernel/gentoo-kernel-bin disable-gcf-lto.conf
sys-kernel/vanilla-kernel disable-gcf-lto.conf

# TODO: This list is currently under construction
dev-libs/libaio remove-gcc-lto.conf
media-libs/alsa-lib remove-gcc-lto.conf
media-libs/x264 remove-gcc-lto.conf
sys-devel/clang remove-gcc-lto.conf # long linking times
sys-devel/llvm remove-gcc-lto.conf # it takes unusally a long time to complete a .c file
sys-libs/compiler-rt remove-gcc-lto.conf
sys-libs/compiler-rt-sanitizers remove-gcc-lto.conf
sys-libs/glibc remove-gcc-lto.conf
sys-libs/libapparmor remove-gcc-lto.conf
sys-libs/libomp remove-gcc-lto.conf

net-libs/libtorrent disable-thinlto.conf use-gold.conf

# Compiler switch check false positives:
dev-libs/boost disable-override-compiler-check.conf # From build script side
dev-qt/qtgui disable-override-compiler-check.conf # Searches headers with gcc in the path
media-libs/flac disable-override-compiler-check.conf # Links to non-LTO from gcc .o file from a path string containing gcc
media-libs/libaom disable-override-compiler-check.conf # Filename
media-libs/libvpx disable-override-compiler-check.conf # From build script side
media-video/ffmpeg disable-override-compiler-check.conf # only enable this if you are not using static-libs for this package
sys-libs/compiler-rt disable-override-compiler-check.conf # Contains files named gcc
sys-libs/compiler-rt-sanitizers disable-override-compiler-check.conf # Packages linked with non-LTOed -lgcc_s
sys-libs/libcxxabi disable-override-compiler-check.conf # Uncomment if building with clang.  Stays commented when CC_LTO != CC_LIBC.
sys-libs/libcxx disable-override-compiler-check.conf # Uncomment if building with clang.  Stays commented when CC_LTO != CC_LIBC.
sys-libs/llvm-libunwind disable-override-compiler-check.conf # links to -lgcc_s and filenames containing gcc

# Binary only packages.  The libs may use CFI Basic mode instead of CFI Cross-DSO mode.
media-sound/spotify disable-cfi-verify.conf
www-client/google-chrome disable-cfi-verify.conf

sys-libs/slang makeopts-broken.conf

# Smooth out multitasking
dev-libs/boost makeopts-swappy.conf
dev-qt/qtwebengine makeopts-swappy.conf
media-libs/libaom makeopts-swappy.conf
sys-devel/clang makeopts-severe-swapping.conf
sys-devel/gcc makeopts-swappy.conf
sys-devel/llvm makeopts-swappy.conf
net-libs/nodejs makeopts-swappy.conf
net-libs/webkit-gtk makeopts-swappy.conf
www-client/chromium makeopts-swappy.conf
www-client/firefox makeopts-swappy.conf

# Adding exceptions will increase the attack surface.
# The minimal exception set or -fsanitize-ignore list must be used.
# This list is incomplete.  It is implied that -fno-sanitize=icall
# is added to packages with dlopen() present in any binary which bashrc
# script adds due to the high build failure ratio.
# TODO: Eliminate and convert [Err 6, Err 5, Err 8] into -fsanitize-ignorelist=
app-arch/cpio no-cfi-icall.conf # Breaks unpacking with rpm2tar
app-shells/bash no-cfi-icall.conf # Runtime problems [Err 6]
dev-lang/vala no-cfi-icall.conf # Build time failure when building libsoup [Err 6]
dev-libs/fribidi no-cfi-icall.conf # Build time failures: [Err 1]
dev-libs/icu no-cfi-icall.conf no-cfi-nvcall.conf # Build time breakage.  Illegal instruction
dev-libs/libaio no-cfi-icall.conf # Build time failures: [Err 2]
dev-libs/libbsd no-cfi-icall.conf # Build time failures: [Err 2]
dev-libs/libinput no-cfi-icall.conf # Error when running startx [Err 6]
dev-libs/libpipeline no-cfi-icall.conf # Build time failures: [Err 1]
dev-libs/libunistring no-cfi-icall.conf # Build time failures: [Err 1]
dev-libs/lzo no-cfi-icall.conf # Build time failures: [Err 1]
dev-libs/oniguruma no-cfi-icall.conf # Build time failures: [Err 1]
dev-libs/newt no-cfi-icall.conf # [Err 6] in nmtui
dev-python/cython no-cfi-icall.conf # Build time failure in dev-python/lxml [Err 12]
dev-python/lxml no-cfi-icall.conf # Build time failure while building elogind: [Err 6]
dev-python/pygobject no-cfi-icall.conf # Build time failure [Err 6] while building networkmanager
dev-util/ccache cfi-ignore-list.conf # Breaks during setup phase of other packages with [Err 5, Err 8].  To repair, you must disable ccache in FEATURES when re-emerging to avoid CFI error.
dev-util/cppunit no-cfi-nvcall.conf no-cfi-cast.conf no-cfi-vcall.conf # Build time failures: [Err 1, Err 3 when no-cfi-cast.conf removed]
dev-util/pkgconf no-cfi-icall.conf # Build time failures: [Err 1]
dev-vcs/subversion no-cfi-icall.conf # Build time failures: [Err 1]
gnome-base/gconf no-cfi-icall.conf # Build time failures: [Err 1]
gnome-base/gnome-desktop no-cfi-icall.conf # Build time failures: [Err 6, Err 4 (non-fatal from libxfconf-0.so.3, libdbus-glib-1.so.2)]
gnome-base/gnome-keyring no-cfi-icall.conf # Build time failures: [Err 1]
gnome-base/libgnome-keyring no-cfi-icall.conf # Build time failures: [Err 1]
media-libs/audiofile no-cfi-nvcall.conf no-cfi-cast.conf no-cfi-vcall.conf no-cfi-icall.conf # Build time failure
media-libs/flac no-cfi-icall.conf  # undefined symbol: __cfi_slowpath with pulseaudio -k, Breaks CEF
media-libs/freetype no-cfi-icall.conf # Build time failures: [Err 1]
media-libs/lcms no-cfi-icall.conf # Build time failures: [Err 1]
media-libs/libaom no-cfi-icall.conf # Prevent Illegal instruction with /usr/bin/aomdec --help
media-libs/libass no-cfi-icall.conf # Build time failures: [Err 1]
media-libs/libexif no-cfi-icall.conf # [Err 9] when building eog
media-libs/libjpeg-turbo no-cfi-icall.conf # Breaks precompiled CEF based apps
media-libs/libogg no-cfi-icall.conf # Breaks precompiled CEF based apps, alsa-plugins
media-libs/libpng no-cfi-icall.conf # Build time failures: [Err 1]
media-libs/libpng-compat no-cfi-icall.conf # Build time failures: [Err 1]
media-libs/libsndfile no-cfi-icall.conf # [Err 9] with pulseaudio -k when pulseaudio built without CFI.  Breaks YT audio with Firefox.
media-libs/libvorbis no-cfi-icall.conf # Breaks playing yt in firefox-bin
media-libs/libvpx no-cfi-icall.conf # Prevent illegal instruction with vpxenc --help
media-libs/opus no-cfi-icall.conf # Build time failures: [Err 1]
media-libs/speexdsp no-cfi-icall.conf # [Err 9] with pulseaudio -k when pulseaudio built without CFI.  Breaks audio on Firefox.
media-gfx/qrencode no-cfi-icall.conf # Build time failures: [Err 1]
media-plugins/alsa-plugins linker-errors-as-warnings.conf # [Err 9]
media-video/ffmpeg no-cfi-icall.conf # ffprobe problems
net-libs/libmnl no-cfi-icall.conf # Build time failures: [Err 1]
net-libs/libndp no-cfi-icall.conf # Build time failures: [Err 1]
net-libs/libtorrent no-cfi-nvcall.conf no-cfi-cast.conf no-cfi-vcall.conf no-cfi-icall.conf # Build time failures: [Err 3]
sys-apps/pciutils no-cfi-icall.conf # Build time failure error: unable to execute command: Segmentation fault
sys-devel/clang no-cfi-nvcall.conf no-cfi-cast.conf # Build time failures: [Err 8] with llvm header, [Err 5] with gcc header
sys-libs/libcxx no-cfi-icall.conf # Build time failures: Illegal instruction in icu package
sys-libs/ncurses no-cfi-icall.conf # Non-fatal run time failure [Err 6] when pressing ctrl+c in less
sys-process/audit no-cfi-icall.conf # Build time failures: [Err 1]
x11-drivers/xf86-video-amdgpu no-cfi-icall.conf # Build time failures: [Err 1]
x11-drivers/xf86-video-dummy no-cfi-icall.conf # Build time failures: [Err 1]
x11-libs/libfontenc no-cfi-icall.conf # Build time failures: [Err 1]
x11-libs/libICE no-cfi-icall.conf # Build time failures: [Err 1]
x11-libs/libXcursor no-cfi-icall.conf # Build time failures: [Err 1]
x11-libs/libXext no-cfi-icall.conf # Build time failures: [Err 1]
x11-libs/libXfont2 no-cfi-icall.conf # Build time failures: [Err 1]
x11-libs/libXft no-cfi-icall.conf # Build time failures: [Err 1]
x11-libs/libxkbfile no-cfi-icall.conf # Build time failures: [Err 1]
x11-libs/libXmu no-cfi-icall.conf # Build time failures: [Err 1]
x11-libs/libXpm no-cfi-icall.conf # Build time failures: [Err 1]
x11-libs/xcb-util-renderutil no-cfi-icall.conf # [Err 9] when building dev-qt/qtgui
x11-terms/xfce4-terminal no-cfi-icall.conf # Runtime failure when right clicking [Err 6]
x11-themes/gtk-engines-adwaita no-cfi-icall.conf # Build time failures: [Err 1]
x11-themes/gtk-engines-murrine no-cfi-icall.conf # Build time failures: [Err 1]
xfce-base/libxfce4util no-cfi-canonical-jump-tables.conf # Build time failure: [Err 11]

# Split group because some may be non-fatal depending on config and use case if disabled line.
dev-libs/dbus-glib no-cfi-icall.conf # firefox-bin: [Err 9 (fatal)]
media-libs/fontconfig no-cfi-icall.conf # firefox-bin: [Err 9 (fatal)]
x11-libs/libxcb no-cfi-icall.conf # CEF, firefox-bin: [Err 6 (non-fatal), Err 9 (fatal)]
x11-libs/libXcomposite no-cfi-icall.conf # CEF, firefox-bin: [Err 6 (non-fatal), Err 9 (fatal)]
x11-libs/libXdamage no-cfi-icall.conf # CEF, firefox-bin: [Err 6 (non-fatal), Err 9 (fatal)]
x11-libs/libXfixes no-cfi-icall.conf # CEF, firefox-bin: [Err 6 (non-fatal), Err 9 (fatal)]
x11-libs/libXi no-cfi-icall.conf # CEF, firefox-bin: [Err 6 (non-fatal), Err 9 (fatal)]
x11-libs/libXrandr no-cfi-icall.conf # CEF, firefox-bin: [Err 6 (non-fatal), Err 9 (fatal)]
x11-libs/libXrender no-cfi-icall.conf # firefox-bin: [Err 6 (non-fatal), Err 4 (fatal), Err 9 (fatal)]
x11-libs/libXScrnSaver no-cfi-icall.conf # firefox-bin: [Err 6 (non-fatal)]
xfce-base/xfconf no-cfi-icall.conf # firefox-bin: [Err 9 (non-fatal)]

# [Err 1]: lto-llvm-[a-z0-9]+.o: relocation .* against hidden symbol `__typeid__.*_align' can not be used when making a shared object
# [Err 2]: ld.lld: error: <inline asm>:[0-9]+:[0-9]+: default version symbol .* must be defined
# [Err 3]: ld-temp.o:(.text.startup+0x20): undefined reference to `__dso_handle'
#	   lto-llvm-[a-z0-9]+.o: relocation .* against undefined hidden symbol `__dso_handle' can not be used when making a shared object
# [Err 4]: # undefined symbol: __ubsan_handle_cfi_check_fail_abort
# [Err 5]: runtime error: control flow integrity check for type '.*' failed during cast to unrelated type (vtable address 0x[0-9a-z]+)
# [Err 6]: runtime error: control flow integrity check for type '.*' failed during indirect function call
# [Err 7]: ==558==ERROR: SanitizerTool failed to allocate noreserve 0x0 (0) bytes of CFI shadow (error code: 22)
# [Err 8]: control flow integrity check for type '.*' failed during non-virtual call (vtable address 0x[0-9a-z]+)
# [Err 9]: undefined symbol: __cfi_slowpath_diag
# [Err 10]: undefined symbol: __ubsan_handle_type_mismatch_v1_abort
# [Err 11]: .*.c:83:1: runtime error: control flow integrity check for type '.*' failed during indirect function call
#	    AND
#	    (/usr/lib.*/.*.so.*\+[0-9a-z]+): note: .* defined here
# [Err 12]: runtime error: control flow integrity check for type '.*' failed during indirect function call
#	    AND
#	    (/usr/lib/python.*/site-packages/.*.so+0x[0-9a-z]+): note: (unknown) defined here

# CFI warnings (all binary packages)
# For source based packages, rebuilding the package with the executible may \
# eliminate Err 4.
media-sound/spotify cfi-preload-app.conf # Breaks on load [Err 4]
net-libs/cef-bin cfi-preload-app.conf
www-client/firefox-bin cfi-preload-app.conf # Breaks on load [Err 4]
www-client/google-chrome cfi-preload-app.conf # Breaks on load [Err 4]

# Disable Clang CFI Cross-DSO
# Anything that breaks CFI bootstrapping or clang live ebuilds should go here so
# it doesn't bork the system or toolchain.
# Packages that use g-ir-scanner (from gobject-introspection) may have to have disable-clang-cfi.conf
app-accessibility/at-spi2-atk disable-clang-cfi.conf # Breaks chrome [Err 7]
app-accessibility/at-spi2-core disable-clang-cfi.conf # Build time failure: [Err 7]
app-admin/keepassxc disable-clang-cfi.conf # Ebuild strips -flto, [Err 3, Err 9]
app-crypt/argon2 disable-clang-cfi.conf # Breaks keepassxc [Err 7]
app-i18n/uchardet disable-clang-cfi.conf # Breaks mpv [Err 7]
app-text/poppler disable-clang-cfi.conf # Build time failure [Err 7]
dev-libs/atk disable-clang-cfi.conf # Build time failures [Err 7]
dev-libs/glib disable-clang-cfi.conf # Build time failures in gobject-introspection [Err 7]
dev-libs/gobject-introspection disable-clang-cfi.conf # Build time failure: [Err 7, Err 4]
dev-libs/icu disable-clang-cfi.conf # Build time failure [Err 7] when building vte
dev-libs/json-glib disable-clang-cfi.conf # Build time failures [Err 7]
dev-libs/libnl disable-clang-cfi.conf # Breaks all linkers and wpa_supplicant, Build time failures: [Err 1]
dev-libs/libpeas disable-clang-cfi.conf # Build time error [Err 7]
dev-libs/libsodium no-cfi-icall.conf  # [Err 9] when building with keepassxc without CFI.  Line removal possible with keepassxc with CFI.
dev-libs/nspr disable-clang-cfi.conf # Breaks chrome [Err 7]
dev-libs/nss disable-clang-cfi.conf # Broken build time [Err 7]
dev-qt/qtconcurrent disable-clang-cfi.conf # Breaks keepassxc [Err 7]
dev-qt/qtdbus disable-clang-cfi.conf # Breaks keepassxc [Err 7]
dev-qt/qtnetwork disable-clang-cfi.conf # Breaks keepassxc [Err 7]
dev-qt/qtsvg disable-clang-cfi.conf # Breaks keepassxc [Err 7]
dev-qt/qtwidgets disable-clang-cfi.conf # Breaks keepassxc [Err 7]
media-gfx/eog disable-clang-cfi.conf # Build time error [Err 7, Err 4]
media-gfx/graphite2 disable-clang-cfi.conf # Build time failure when building harfbuzz [Err 7].  Line removal conditioned on the existence of media-libs/harfbuzz line
media-libs/harfbuzz disable-clang-cfi.conf # Build time failure [Err 7] # Non fatal errors from dev-libs/dbus-glib and xfce-base/xfconf.
media-libs/libepoxy disable-clang-cfi.conf # Breaks gtk+ during build time [Err 7]
media-libs/libglvnd disable-clang-cfi.conf # Causes segfault when starting startx and mpv
media-libs/mesa disable-clang-cfi.conf # Runtime error when running startx CFI: CHECK failed: cfi.cpp:311 "((0)) == ((GetShadow()))" (0x0, 0x[a-z0-9]+) (tid=[0-9]+)
media-libs/webrtc-audio-processing disable-clang-cfi.conf # [Err 9] when building pulseaudio.  Line removal depends on pulseaudio with disabled CFI
media-sound/pulseaudio disable-clang-cfi.conf # Breaks YT sound on Firefox with with UBSan
net-libs/cef-bin disable-clang-cfi.conf # CFI Cross-DSO breaks with [Err 7] with cefsimple, cefclient
net-libs/libsoup disable-clang-cfi.conf # Build time failure [Err 7, Err 4]
net-misc/dhcpcd disable-clang-cfi.conf # CFI: CHECK failed: cfi.cpp:311 "((0)) == ((GetShadow()))" (0x0, 0x[a-z0-9]+) (tid=[0-9]+)
net-print/cups disable-clang-cfi.conf # Breaks chrome [Err 7]
sys-libs/libomp disable-clang-cfi.conf # Build time failure
sys-libs/zlib use-gcc.conf disable-clang-cfi.conf # breaks pngfix,  Prevents loading of precompiled www browser
x11-libs/gdk-pixbuf disable-clang-cfi.conf # Build time breakage with [Err 7]
x11-libs/gtksourceview disable-clang-cfi.conf # Build time error [Err 7]
x11-libs/libdrm disable-clang-cfi.conf # Error when running startx [Err 7]
x11-libs/libX11 disable-clang-cfi.conf # Causes segfault when using startx
x11-libs/pango disable-clang-cfi.conf # Build time error [Err 7]
x11-libs/pixman disable-clang-cfi.conf # [Err 7] when running xorg
x11-libs/vte disable-clang-cfi.conf # Build time error [Err 7].

#sys-devel/lld use-gcc.conf # Use this to rebuild without CFI when running into CFI cast check bugs.  Build time failures: [Err 5] when building sys-process/audit and rebuilding itself
sys-devel/lld no-cfi-cast.conf # Build time failures: [Err 5] when building sys-process/audit and rebuilding itself

# Do not strip CFI in .so files
media-libs/libaom no-strip.conf
media-libs/libvpx no-strip.conf
sys-libs/libcxxabi no-strip.conf

# Temporarly disable Clang/CFI in network subsystem until the source of random
# unstability problems is found.  Can be problems with ISP, router, etc.
net-wireless/crda use-gcc.conf
net-wireless/wpa_supplicant use-gcc.conf
